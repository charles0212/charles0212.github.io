{"title":"HBase（二）Docker搭建","slug":"yuque/HBase（二）Docker搭建","date":"2020-06-21T16:00:00.000Z","updated":"2022-05-15T04:19:28.494Z","comments":true,"path":"api/articles/hbase/hbase-docker.json","excerpt":"docker 脚本可以从链接获取修改 docker-compse.xml文件，注意端口映射version: \"2\"services:  zookeeper-1:    container_name: zookeeper-1    networks: [\"vnet\"]    hostname: zookeeper-1.vnet    image: smizy/zookeeper:3.4-alpine    ports:  [\"2181:2181\"]    environment:      - SERVICE_2181_NAME=zookeeper      - S","covers":["/images/c1.jpg"],"content":"<p>docker 脚本可以<a href=\"https://github.com/smizy/docker-hbase\">从链接获取</a><br>修改 docker-compse.xml 文件，注意端口映射</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">version: &quot;2&quot;\nservices:\n\n  zookeeper-1:\n    container_name: zookeeper-1\n    networks: [&quot;vnet&quot;]\n    hostname: zookeeper-1.vnet\n    image: smizy&#x2F;zookeeper:3.4-alpine\n    ports:  [&quot;2181:2181&quot;]\n    environment:\n      - SERVICE_2181_NAME&#x3D;zookeeper\n      - SERVICE_2888_IGNORE&#x3D;true\n      - SERVICE_3888_IGNORE&#x3D;true\n\n    command: -server 1 1 vnet\n\n  namenode-1:\n    container_name: namenode-1\n    networks: [&quot;vnet&quot;]\n    hostname: namenode-1.vnet\n    image: smizy&#x2F;hadoop-base:2.7.6-alpine\n    expose: [&quot;8020&quot;]\n    ports:  [&quot;50070:50070&quot;,&quot;8020:8020&quot;]\n    environment:\n      - SERVICE_8020_NAME&#x3D;namenode\n      - SERVICE_50070_IGNORE&#x3D;true\n      - HADOOP_ZOOKEEPER_QUORUM&#x3D;zookeeper-1.vnet:2181\n      - HADOOP_HEAPSIZE&#x3D;1000\n      - HADOOP_NAMENODE_HA&#x3D;\n\n    entrypoint: entrypoint.sh\n    command: namenode-1\n\n  datanode-1:\n    container_name: datanode-1\n    networks: [&quot;vnet&quot;]\n    hostname: datanode-1.vnet\n    image: smizy&#x2F;hadoop-base:2.7.6-alpine\n    expose: [&quot;50010&quot;, &quot;50020&quot;, &quot;50075&quot;]\n    environment:\n      - SERVICE_50010_NAME&#x3D;datanode\n      - SERVICE_50020_IGNORE&#x3D;true\n      - SERVICE_50075_IGNORE&#x3D;true\n      - HADOOP_ZOOKEEPER_QUORUM&#x3D;zookeeper-1.vnet:2181\n      - HADOOP_HEAPSIZE&#x3D;1000\n      - HADOOP_NAMENODE_HA&#x3D;\n\n    entrypoint: entrypoint.sh\n    command: datanode\n\n  hmaster-1:\n    container_name: hmaster-1\n    networks: [&quot;vnet&quot;]\n    hostname: hmaster-1.vnet\n    image: smizy&#x2F;hbase:1.2.6.1-alpine\n    expose: [16000]\n    ports:  [&quot;16010:16010&quot;,&quot;16000:16000&quot;]\n    depends_on: [&quot;zookeeper-1&quot;]\n    environment:\n      - SERVICE_16000_NAME&#x3D;hmaster\n      - SERVICE_16010_IGNORE&#x3D;true\n      - HBASE_ZOOKEEPER_QUORUM&#x3D;zookeeper-1.vnet:2181\n\n    volumes_from:\n      - namenode-1\n    command: hmaster-1\n\n  regionserver-1:\n    container_name: regionserver-1\n    networks: [&quot;vnet&quot;]\n    hostname: regionserver-1.vnet\n    image: smizy&#x2F;hbase:1.2.6.1-alpine\n    expose: [16020, 16030]\n    ports: [&quot;16020:16020&quot;, &quot;16030:16030&quot;]\n    depends_on: [&quot;zookeeper-1&quot;]\n    environment:\n      - SERVICE_16020_NAME&#x3D;regionserver\n      - SERVICE_16030_IGNORE&#x3D;true\n      - HBASE_ZOOKEEPER_QUORUM&#x3D;zookeeper-1.vnet:2181\n\n    command: regionserver\n\nnetworks:\n  vnet:\n    external:\n      name: vnet</code></pre>\n\n<h2 id=\"运行-Hadoop-和-Hbase\"><a href=\"#运行-Hadoop-和-Hbase\" class=\"headerlink\" title=\"运行 Hadoop 和 Hbase\"></a>运行 Hadoop 和 Hbase</h2><pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"># docker-machine default\ndocker-machine create --engine-registry-mirror&#x3D;https:&#x2F;&#x2F;xxx.mirror.aliyuncs.com -d virtualbox default\n\n# load default env as needed\neval $(docker-machine env default)\n\n# network\ndocker network create vnet\n\n# make docker-compose.yml with small size (no redudency)\nzookeeper&#x3D;1 namenode&#x3D;1 datanode&#x3D;1 .&#x2F;make_docker_compose_yml.sh hdfs hbase &gt; docker-compose.yml\n\n# or with default size(zookeeper&#x3D;3, namenode&#x3D;2, journalnode&#x3D;3, datanode&#x3D;3, hmaster&#x3D;2, regionserver&#x3D;3)\n.&#x2F;make_docker_compose_yml.sh hdfs hbase &gt; docker-compose.yml\n\n# hadoop+hbase startup\ndocker-compose up -d\n\n# tail logs for a while\ndocker-compose logs -f\n\n# check ps\ndocker-compose ps\n\n     Name                   Command               State                  Ports\n---------------------------------------------------------------------------------------------\ndatanode-1       entrypoint.sh datanode           Up      50010&#x2F;tcp, 50020&#x2F;tcp, 50075&#x2F;tcp\nhmaster-1        entrypoint.sh hmaster-1          Up      16000&#x2F;tcp, 0.0.0.0:32771-&gt;16010&#x2F;tcp\nnamenode-1       entrypoint.sh namenode-1         Up      0.0.0.0:32770-&gt;50070&#x2F;tcp, 8020&#x2F;tcp\nregionserver-1   entrypoint.sh regionserver       Up      16020&#x2F;tcp, 16030&#x2F;tcp\nzookeeper-1      entrypoint.sh -server 1 1 vnet   Up      2181&#x2F;tcp, 2888&#x2F;tcp, 3888&#x2F;tcp\n\n# check stats\ndocker ps --format &#123;&#123;.Names&#125;&#125; | xargs docker stats\n\n# hbase shell\ndocker exec -it -u hbase regionserver-1 hbase shell\nhbase(main):001:0&gt; create &#39;test&#39;, &#39;cf&#39;\nhbase(main):002:0&gt; list &#39;test&#39;\nhbase(main):003:0&gt; put &#39;test&#39;, &#39;row1&#39;, &#39;cf:a&#39;, &#39;value1&#39;\nhbase(main):004:0&gt; put &#39;test&#39;, &#39;row2&#39;, &#39;cf:b&#39;, &#39;value2&#39;\nhbase(main):005:0&gt; put &#39;test&#39;, &#39;row3&#39;, &#39;cf:c&#39;, &#39;value3&#39;\nhbase(main):006:0&gt; scan &#39;test&#39;\nhbase(main):007:0&gt; get &#39;test&#39;, &#39;row1&#39;\nhbase(main):008:0&gt; disable &#39;test&#39;\nhbase(main):009:0&gt; drop &#39;test&#39;\nhbase(main):010:0&gt; exit\n\n# hadoop&#x2F;hbase shutdown\ndocker-compose stop\n\n# cleanup container\ndocker-compose rm -v</code></pre>\n","more":"<p>docker 脚本可以<a href=\"https://github.com/smizy/docker-hbase\">从链接获取</a><br>修改 docker-compse.xml 文件，注意端口映射</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">version: &quot;2&quot;\nservices:\n\n  zookeeper-1:\n    container_name: zookeeper-1\n    networks: [&quot;vnet&quot;]\n    hostname: zookeeper-1.vnet\n    image: smizy&#x2F;zookeeper:3.4-alpine\n    ports:  [&quot;2181:2181&quot;]\n    environment:\n      - SERVICE_2181_NAME&#x3D;zookeeper\n      - SERVICE_2888_IGNORE&#x3D;true\n      - SERVICE_3888_IGNORE&#x3D;true\n\n    command: -server 1 1 vnet\n\n  namenode-1:\n    container_name: namenode-1\n    networks: [&quot;vnet&quot;]\n    hostname: namenode-1.vnet\n    image: smizy&#x2F;hadoop-base:2.7.6-alpine\n    expose: [&quot;8020&quot;]\n    ports:  [&quot;50070:50070&quot;,&quot;8020:8020&quot;]\n    environment:\n      - SERVICE_8020_NAME&#x3D;namenode\n      - SERVICE_50070_IGNORE&#x3D;true\n      - HADOOP_ZOOKEEPER_QUORUM&#x3D;zookeeper-1.vnet:2181\n      - HADOOP_HEAPSIZE&#x3D;1000\n      - HADOOP_NAMENODE_HA&#x3D;\n\n    entrypoint: entrypoint.sh\n    command: namenode-1\n\n  datanode-1:\n    container_name: datanode-1\n    networks: [&quot;vnet&quot;]\n    hostname: datanode-1.vnet\n    image: smizy&#x2F;hadoop-base:2.7.6-alpine\n    expose: [&quot;50010&quot;, &quot;50020&quot;, &quot;50075&quot;]\n    environment:\n      - SERVICE_50010_NAME&#x3D;datanode\n      - SERVICE_50020_IGNORE&#x3D;true\n      - SERVICE_50075_IGNORE&#x3D;true\n      - HADOOP_ZOOKEEPER_QUORUM&#x3D;zookeeper-1.vnet:2181\n      - HADOOP_HEAPSIZE&#x3D;1000\n      - HADOOP_NAMENODE_HA&#x3D;\n\n    entrypoint: entrypoint.sh\n    command: datanode\n\n  hmaster-1:\n    container_name: hmaster-1\n    networks: [&quot;vnet&quot;]\n    hostname: hmaster-1.vnet\n    image: smizy&#x2F;hbase:1.2.6.1-alpine\n    expose: [16000]\n    ports:  [&quot;16010:16010&quot;,&quot;16000:16000&quot;]\n    depends_on: [&quot;zookeeper-1&quot;]\n    environment:\n      - SERVICE_16000_NAME&#x3D;hmaster\n      - SERVICE_16010_IGNORE&#x3D;true\n      - HBASE_ZOOKEEPER_QUORUM&#x3D;zookeeper-1.vnet:2181\n\n    volumes_from:\n      - namenode-1\n    command: hmaster-1\n\n  regionserver-1:\n    container_name: regionserver-1\n    networks: [&quot;vnet&quot;]\n    hostname: regionserver-1.vnet\n    image: smizy&#x2F;hbase:1.2.6.1-alpine\n    expose: [16020, 16030]\n    ports: [&quot;16020:16020&quot;, &quot;16030:16030&quot;]\n    depends_on: [&quot;zookeeper-1&quot;]\n    environment:\n      - SERVICE_16020_NAME&#x3D;regionserver\n      - SERVICE_16030_IGNORE&#x3D;true\n      - HBASE_ZOOKEEPER_QUORUM&#x3D;zookeeper-1.vnet:2181\n\n    command: regionserver\n\nnetworks:\n  vnet:\n    external:\n      name: vnet</code></pre>\n\n<h2 id=\"运行-Hadoop-和-Hbase\"><a href=\"#运行-Hadoop-和-Hbase\" class=\"headerlink\" title=\"运行 Hadoop 和 Hbase\"></a>运行 Hadoop 和 Hbase</h2><pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"># docker-machine default\ndocker-machine create --engine-registry-mirror&#x3D;https:&#x2F;&#x2F;xxx.mirror.aliyuncs.com -d virtualbox default\n\n# load default env as needed\neval $(docker-machine env default)\n\n# network\ndocker network create vnet\n\n# make docker-compose.yml with small size (no redudency)\nzookeeper&#x3D;1 namenode&#x3D;1 datanode&#x3D;1 .&#x2F;make_docker_compose_yml.sh hdfs hbase &gt; docker-compose.yml\n\n# or with default size(zookeeper&#x3D;3, namenode&#x3D;2, journalnode&#x3D;3, datanode&#x3D;3, hmaster&#x3D;2, regionserver&#x3D;3)\n.&#x2F;make_docker_compose_yml.sh hdfs hbase &gt; docker-compose.yml\n\n# hadoop+hbase startup\ndocker-compose up -d\n\n# tail logs for a while\ndocker-compose logs -f\n\n# check ps\ndocker-compose ps\n\n     Name                   Command               State                  Ports\n---------------------------------------------------------------------------------------------\ndatanode-1       entrypoint.sh datanode           Up      50010&#x2F;tcp, 50020&#x2F;tcp, 50075&#x2F;tcp\nhmaster-1        entrypoint.sh hmaster-1          Up      16000&#x2F;tcp, 0.0.0.0:32771-&gt;16010&#x2F;tcp\nnamenode-1       entrypoint.sh namenode-1         Up      0.0.0.0:32770-&gt;50070&#x2F;tcp, 8020&#x2F;tcp\nregionserver-1   entrypoint.sh regionserver       Up      16020&#x2F;tcp, 16030&#x2F;tcp\nzookeeper-1      entrypoint.sh -server 1 1 vnet   Up      2181&#x2F;tcp, 2888&#x2F;tcp, 3888&#x2F;tcp\n\n# check stats\ndocker ps --format &#123;&#123;.Names&#125;&#125; | xargs docker stats\n\n# hbase shell\ndocker exec -it -u hbase regionserver-1 hbase shell\nhbase(main):001:0&gt; create &#39;test&#39;, &#39;cf&#39;\nhbase(main):002:0&gt; list &#39;test&#39;\nhbase(main):003:0&gt; put &#39;test&#39;, &#39;row1&#39;, &#39;cf:a&#39;, &#39;value1&#39;\nhbase(main):004:0&gt; put &#39;test&#39;, &#39;row2&#39;, &#39;cf:b&#39;, &#39;value2&#39;\nhbase(main):005:0&gt; put &#39;test&#39;, &#39;row3&#39;, &#39;cf:c&#39;, &#39;value3&#39;\nhbase(main):006:0&gt; scan &#39;test&#39;\nhbase(main):007:0&gt; get &#39;test&#39;, &#39;row1&#39;\nhbase(main):008:0&gt; disable &#39;test&#39;\nhbase(main):009:0&gt; drop &#39;test&#39;\nhbase(main):010:0&gt; exit\n\n# hadoop&#x2F;hbase shutdown\ndocker-compose stop\n\n# cleanup container\ndocker-compose rm -v</code></pre>\n","categories":[{"name":"hbase","path":"api/categories/hbase.json"}],"tags":[{"name":"HBase","path":"api/tags/HBase.json"}]}