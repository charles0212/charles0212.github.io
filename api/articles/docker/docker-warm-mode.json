{"title":"Docker（二）使用Swarm Mode创建集群","slug":"yuque/Docker（二）使用Swarm Mode创建集群","date":"2018-07-11T16:00:00.000Z","updated":"2022-05-15T04:19:28.000Z","comments":true,"path":"api/articles/docker/docker-warm-mode.json","excerpt":"> 能使用 Docker Machine> 的前提是宿主机需要是物理机，云主机目前不支持> Docker Machine 的创建。Virtualbox 安装步骤可参考cd /etc/yum.repos.dwget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repoyum install VirtualBox-5.2Docker Machine 安装命令行安装 docker-machinebase=https://github.com/docker/machine/releas","covers":["/images/c2.jpg"],"content":"<blockquote>\n<p>能使用 Docker Machine 的前提是宿主机需要是物理机，云主机目前不支持 Docker Machine 的创建。</p>\n</blockquote>\n<h2 id=\"Virtualbox-安装\"><a href=\"#Virtualbox-安装\" class=\"headerlink\" title=\"Virtualbox 安装\"></a>Virtualbox 安装</h2><p>步骤<a href=\"https://www.virtualbox.org/wiki/Linux_Downloads\">可参考</a></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cd &#x2F;etc&#x2F;yum.repos.d\nwget http:&#x2F;&#x2F;download.virtualbox.org&#x2F;virtualbox&#x2F;rpm&#x2F;rhel&#x2F;virtualbox.repo\nyum install VirtualBox-5.2</code></pre>\n\n<h2 id=\"Docker-Machine-安装\"><a href=\"#Docker-Machine-安装\" class=\"headerlink\" title=\"Docker Machine 安装\"></a>Docker Machine 安装</h2><h3 id=\"命令行安装-docker-machine\"><a href=\"#命令行安装-docker-machine\" class=\"headerlink\" title=\"命令行安装 docker-machine\"></a>命令行安装 docker-machine</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">base&#x3D;https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;machine&#x2F;releases&#x2F;download&#x2F;v0.15.0 &amp;&amp;\n  curl -L $base&#x2F;docker-machine-$(uname -s)-$(uname -m) &gt;&#x2F;tmp&#x2F;docker-machine &amp;&amp;\n  sudo ixunstall &#x2F;tmp&#x2F;docker-machine &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-machine</code></pre>\n\n<h3 id=\"创建-docker-machine\"><a href=\"#创建-docker-machine\" class=\"headerlink\" title=\"创建 docker-machine\"></a>创建 docker-machine</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-machine create --engine-registry-mirror&#x3D;https:&#x2F;&#x2F;xxx.mirror.aliyuncs.com -d virtualbox manager\ndocker-machine create --engine-registry-mirror&#x3D;https:&#x2F;&#x2F;xxx.mirror.aliyuncs.com -d virtualbox worker1\ndocker-machine create --engine-registry-mirror&#x3D;https:&#x2F;&#x2F;xxx.mirror.aliyuncs.com -d virtualbox worker2</code></pre>\n\n<p>创建 3 台机器，manager 为 leader</p>\n<h3 id=\"初始化-swarm-集群-manager\"><a href=\"#初始化-swarm-集群-manager\" class=\"headerlink\" title=\"初始化 swarm 集群 manager\"></a>初始化 swarm 集群 manager</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-machine ssh manager\ndocker swarm init\nSwarm initialized: current node (bvz81updecsj6wjz393c09vti) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-0bfpg588koug4bricwcs7y4edh70984pnpfx3tj1tmpb83atmn-442mbo6pueqsjcedq8aey04v0 192.168.99.100:2377\n\nTo add a manager to this swarm, run &#39;docker swarm join-token manager&#39; and follow the instructions.</code></pre>\n\n<h3 id=\"机器加入到-swarm-集群\"><a href=\"#机器加入到-swarm-集群\" class=\"headerlink\" title=\"机器加入到 swarm 集群\"></a>机器加入到 swarm 集群</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-machine ssh work1\ndocker swarm join --token SWMTKN-1-0bfpg588koug4bricwcs7y4edh70984pnpfx3tj1tmpb83atmn-442mbo6pueqsjcedq8aey04v0 192.168.99.100:2377</code></pre>\n\n<h2 id=\"Swarm-Mode-集群部署\"><a href=\"#Swarm-Mode-集群部署\" class=\"headerlink\" title=\"Swarm Mode 集群部署\"></a>Swarm Mode 集群部署</h2><h3 id=\"创建-service-服务\"><a href=\"#创建-service-服务\" class=\"headerlink\" title=\"创建 service 服务\"></a>创建 service 服务</h3><p>详细命令<a href=\"https://docs.docker.com/engine/reference/commandline/service_create/\">可参考</a>，部署 etcd <a href=\"https://github.com/appcelerator-archive/docker-etcd\">可参考</a></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-machine ssh manager\n\ndocker network create --driver overlay db\ndocker service create --network db -e SERVICE_NAME&#x3D;etcd -e MIN_SEEDS_COUNT&#x3D;3 --replicas 3 --name etcd appcelerator&#x2F;etcd</code></pre>\n\n<h3 id=\"查看-service-服务\"><a href=\"#查看-service-服务\" class=\"headerlink\" title=\"查看 service 服务\"></a>查看 service 服务</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker@manager:~$ docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\ni0o3eu86v8qhf9pjfgpseytxq *   manager             Ready               Active              Leader              18.06.0-ce\ntafuebh4yfm7c6a753xuq7hu1     worker1             Down                Active                                  18.06.0-ce\nno9dktvpeslqipt6suc6d7va0     worker2             Down                Active</code></pre>\n\n<h3 id=\"其他-service-命令\"><a href=\"#其他-service-命令\" class=\"headerlink\" title=\"其他 service 命令\"></a>其他 service 命令</h3><p>其他详细的命令<a href=\"https://docs.docker.com/engine/swarm/#whats-next\">可参考</a></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker service inspect\ndocker service ls\ndocker service rm\ndocker service scale\ndocker service ps\ndocker service update</code></pre>\n","more":"<blockquote>\n<p>能使用 Docker Machine 的前提是宿主机需要是物理机，云主机目前不支持 Docker Machine 的创建。</p>\n</blockquote>\n<h2 id=\"Virtualbox-安装\"><a href=\"#Virtualbox-安装\" class=\"headerlink\" title=\"Virtualbox 安装\"></a>Virtualbox 安装</h2><p>步骤<a href=\"https://www.virtualbox.org/wiki/Linux_Downloads\">可参考</a></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cd &#x2F;etc&#x2F;yum.repos.d\nwget http:&#x2F;&#x2F;download.virtualbox.org&#x2F;virtualbox&#x2F;rpm&#x2F;rhel&#x2F;virtualbox.repo\nyum install VirtualBox-5.2</code></pre>\n\n<h2 id=\"Docker-Machine-安装\"><a href=\"#Docker-Machine-安装\" class=\"headerlink\" title=\"Docker Machine 安装\"></a>Docker Machine 安装</h2><h3 id=\"命令行安装-docker-machine\"><a href=\"#命令行安装-docker-machine\" class=\"headerlink\" title=\"命令行安装 docker-machine\"></a>命令行安装 docker-machine</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">base&#x3D;https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;machine&#x2F;releases&#x2F;download&#x2F;v0.15.0 &amp;&amp;\n  curl -L $base&#x2F;docker-machine-$(uname -s)-$(uname -m) &gt;&#x2F;tmp&#x2F;docker-machine &amp;&amp;\n  sudo ixunstall &#x2F;tmp&#x2F;docker-machine &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-machine</code></pre>\n\n<h3 id=\"创建-docker-machine\"><a href=\"#创建-docker-machine\" class=\"headerlink\" title=\"创建 docker-machine\"></a>创建 docker-machine</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-machine create --engine-registry-mirror&#x3D;https:&#x2F;&#x2F;xxx.mirror.aliyuncs.com -d virtualbox manager\ndocker-machine create --engine-registry-mirror&#x3D;https:&#x2F;&#x2F;xxx.mirror.aliyuncs.com -d virtualbox worker1\ndocker-machine create --engine-registry-mirror&#x3D;https:&#x2F;&#x2F;xxx.mirror.aliyuncs.com -d virtualbox worker2</code></pre>\n\n<p>创建 3 台机器，manager 为 leader</p>\n<h3 id=\"初始化-swarm-集群-manager\"><a href=\"#初始化-swarm-集群-manager\" class=\"headerlink\" title=\"初始化 swarm 集群 manager\"></a>初始化 swarm 集群 manager</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-machine ssh manager\ndocker swarm init\nSwarm initialized: current node (bvz81updecsj6wjz393c09vti) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-0bfpg588koug4bricwcs7y4edh70984pnpfx3tj1tmpb83atmn-442mbo6pueqsjcedq8aey04v0 192.168.99.100:2377\n\nTo add a manager to this swarm, run &#39;docker swarm join-token manager&#39; and follow the instructions.</code></pre>\n\n<h3 id=\"机器加入到-swarm-集群\"><a href=\"#机器加入到-swarm-集群\" class=\"headerlink\" title=\"机器加入到 swarm 集群\"></a>机器加入到 swarm 集群</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-machine ssh work1\ndocker swarm join --token SWMTKN-1-0bfpg588koug4bricwcs7y4edh70984pnpfx3tj1tmpb83atmn-442mbo6pueqsjcedq8aey04v0 192.168.99.100:2377</code></pre>\n\n<h2 id=\"Swarm-Mode-集群部署\"><a href=\"#Swarm-Mode-集群部署\" class=\"headerlink\" title=\"Swarm Mode 集群部署\"></a>Swarm Mode 集群部署</h2><h3 id=\"创建-service-服务\"><a href=\"#创建-service-服务\" class=\"headerlink\" title=\"创建 service 服务\"></a>创建 service 服务</h3><p>详细命令<a href=\"https://docs.docker.com/engine/reference/commandline/service_create/\">可参考</a>，部署 etcd <a href=\"https://github.com/appcelerator-archive/docker-etcd\">可参考</a></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker-machine ssh manager\n\ndocker network create --driver overlay db\ndocker service create --network db -e SERVICE_NAME&#x3D;etcd -e MIN_SEEDS_COUNT&#x3D;3 --replicas 3 --name etcd appcelerator&#x2F;etcd</code></pre>\n\n<h3 id=\"查看-service-服务\"><a href=\"#查看-service-服务\" class=\"headerlink\" title=\"查看 service 服务\"></a>查看 service 服务</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker@manager:~$ docker node ls\nID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION\ni0o3eu86v8qhf9pjfgpseytxq *   manager             Ready               Active              Leader              18.06.0-ce\ntafuebh4yfm7c6a753xuq7hu1     worker1             Down                Active                                  18.06.0-ce\nno9dktvpeslqipt6suc6d7va0     worker2             Down                Active</code></pre>\n\n<h3 id=\"其他-service-命令\"><a href=\"#其他-service-命令\" class=\"headerlink\" title=\"其他 service 命令\"></a>其他 service 命令</h3><p>其他详细的命令<a href=\"https://docs.docker.com/engine/swarm/#whats-next\">可参考</a></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">docker service inspect\ndocker service ls\ndocker service rm\ndocker service scale\ndocker service ps\ndocker service update</code></pre>\n","categories":[{"name":"docker","path":"api/categories/docker.json"}],"tags":[{"name":"Docker","path":"api/tags/Docker.json"}]}