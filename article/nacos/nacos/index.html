<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta name="referrer" content="no-referrer">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>
        
        Nacos简介 |
        
        启航的蜗牛</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- open graph -->
    <meta name="description" content="&gt; https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;375912272 &gt; &gt; &gt; https:&#x2F;&#x2F;www.cnblogs.com&#x2F;crazymakercircle&#x2F;p&#x2F;14231815.html   1、Nacos 优势  问题，既然有了 Eureka ，为啥还要用 Nacos？ 而 Nacos 作为微服务核心的服务注册与发现中心，让大家在 Eureka 和 Consule 之外有了新">
<meta property="og:type" content="article">
<meta property="og:title" content="Nacos简介">
<meta property="og:url" content="https://www.alicharles.com/article/nacos/nacos/index.html">
<meta property="og:site_name" content="启航的蜗牛">
<meta property="og:description" content="&gt; https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;375912272 &gt; &gt; &gt; https:&#x2F;&#x2F;www.cnblogs.com&#x2F;crazymakercircle&#x2F;p&#x2F;14231815.html   1、Nacos 优势  问题，既然有了 Eureka ，为啥还要用 Nacos？ 而 Nacos 作为微服务核心的服务注册与发现中心，让大家在 Eureka 和 Consule 之外有了新">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/104130/1647146414817-3e1648bd-2623-4690-bf28-9e42a3d67114.png#clientId=ued4b6436-aafe-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=236&id=ud337bae4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=766&originWidth=1864&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=180596&status=done&style=none&taskId=ue131811e-f697-4ada-ab96-a532ee5bbcd&title=&width=574">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/104130/1647146632603-f0389671-a4b1-481c-9ead-1871422c593e.png#clientId=ued4b6436-aafe-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=250&id=u4d3e389c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=500&originWidth=1100&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=208181&status=done&style=none&taskId=udfc84aec-adb9-4cae-9349-11426a58d84&title=&width=550">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/104130/1647101731578-6fa3b395-c472-471e-8678-93d3bdce7aea.png#clientId=u7f5edb5f-179e-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ucbab9220&margin=%5Bobject%20Object%5D&name=image.png&originHeight=426&originWidth=1240&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=67704&status=done&style=none&taskId=ucbc9e81e-8cda-4413-9ca9-4a43b84f3d8&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/104130/1647101735764-f1376194-ae1a-442b-b723-ca0ebfd2b150.png#clientId=u7f5edb5f-179e-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=uca2877fe&margin=%5Bobject%20Object%5D&name=image.png&originHeight=476&originWidth=1098&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=39460&status=done&style=none&taskId=u19bfb715-4a35-4204-b23d-f66450a2c6e&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/104130/1647101735813-7e09f91a-e566-44dc-84c1-1ee7fd5362f3.png#clientId=u7f5edb5f-179e-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ude292ffd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=616&originWidth=1419&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=54160&status=done&style=none&taskId=u04ec9c2b-0562-442d-9fba-e72db88e109&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/104130/1647149978462-a0be9d46-22fa-44d9-b96f-6a8861c93f51.png#clientId=ud9238c9c-8bab-4&crop=0&crop=0.0867&crop=1&crop=0.794&from=paste&height=1125&id=u33618615&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1125&originWidth=2000&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=108422&status=done&style=none&taskId=u1b99182e-30dd-4d07-8b92-e0f135109da&title=&width=2000">
<meta property="article:published_time" content="2021-03-19T16:00:00.000Z">
<meta property="article:modified_time" content="2022-05-15T04:19:28.000Z">
<meta property="article:author" content="charles">
<meta property="article:tag" content="Nacos">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2022/png/104130/1647146414817-3e1648bd-2623-4690-bf28-9e42a3d67114.png#clientId=ued4b6436-aafe-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=236&id=ud337bae4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=766&originWidth=1864&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=180596&status=done&style=none&taskId=ue131811e-f697-4ada-ab96-a532ee5bbcd&title=&width=574">

    <link rel="shortcut icon" href="/images/logo.png" type="image/png">
    <link rel="icon" sizes="any" mask href="/images/logo.svg">
    <!-- css -->
    
<link rel="stylesheet" href="/css/bootstrap.css">

    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/lib/fontawesome/css/all.css">

    
<link rel="stylesheet" href="/lib/prism/css/prism.css">


    

<meta name="generator" content="Hexo 6.2.0"></head>


<body>

  <!-- Nav -->
  <header>
    <nav class="navbar navbar-expand-md navbar-light charles-navbar py-0">
        <div class="container">
            <a class="navbar-brand mr-0 mr-md-2" href="/">
                <img src="/images/charles-logo.png" height="32px" width="80px" alt="charles">
            </a>
            <button class="navbar-toggler"
                    type="button"
                    data-toggle="collapse"
                    data-target="#navbarDropdown">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">主页<span class="sr-only">(current)</span></a>
                    </li>
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" target="_blank">
                            推荐
                        </a>
                        <div class="dropdown-menu dropdown-menu-right mt-0" >
                            <div class="row mx-0" style="width: 16rem">
                                
                                
                                    
                                    
                                    <div class="col-sm " style="overflow: hidden;">
                                        
                                            <a class="nav-link" href="/categories/jvm/" target="_blank">JVM</a>
                                        
                                            <a class="nav-link" href="/categories/design-pattern/" target="_blank">设计模式</a>
                                        
                                            <a class="nav-link" href="/tags/Lock/" target="_blank">Java锁</a>
                                        
                                    </div>
                                    
                                    
                                
                                    
                                    
                                    <div class="col-sm  border-left " style="overflow: hidden;">
                                        
                                            <a class="nav-link" href="/categories/disruptor/" target="_blank">Disruptor</a>
                                        
                                            <a class="nav-link" href="/categories/netty/" target="_blank">Netty</a>
                                        
                                            <a class="nav-link" href="/categories/ddd/" target="_blank">领域驱动设计</a>
                                        
                                    </div>
                                    
                                    
                                
                            </div>
                        </div>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/categories" target="_blank">分类</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tags" target="_blank">标签</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/archives" target="_blank">归档</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about" target="_blank">关于</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/search" target="_blank">搜索</a>
                    </li>
                </ul>
            </div>
        </div> <!-- /container -->
    </nav>
</header>


  <!-- Main Content -->
  <div class="container bg-white my-3">
    <div class="post-article">
        <section id="posts" class="posts-expand">
            <h1>Nacos简介</h1>
<header class="post-header">
     <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="fa far fa-user"></i>
        </span>
        <span class="post-meta-item-text">发表于</span>
        <time itemprop="dateCreated" datetime="2021-03-20T00:00:00+08:00">
            2021-03-20
        </time>
    </span>
    <span class="post-category">
        
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="fa far fa-calendar-alt"></i>
        </span>
        <span class="post-meta-item-text">分类于</span>
        
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
            <a href="/categories/nacos/" itemprop="url" rel="index">
              <span itemprop="name">nacos</span>
            </a>
        </span>
        
    
    </span>
</header>
<div class="post-body">
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/375912272">https://zhuanlan.zhihu.com/p/375912272</a> &gt; <a target="_blank" rel="noopener" href="https://www.cnblogs.com/crazymakercircle/p/14231815.html">https://www.cnblogs.com/crazymakercircle/p/14231815.html</a></p>
</blockquote>
<h2 id="1、Nacos-优势"><a href="#1、Nacos-优势" class="headerlink" title="1、Nacos 优势"></a>1、Nacos 优势</h2><p>问题，既然有了 Eureka ，为啥还要用 Nacos？<br>而 Nacos 作为微服务核心的服务注册与发现中心，让大家在 Eureka 和 Consule 之外有了新的选择，开箱即用，上手简洁，暂时也没发现有太大的坑。</p>
<h3 id="1-1、与-eureka-对比"><a href="#1-1、与-eureka-对比" class="headerlink" title="1.1、与 eureka 对比"></a>1.1、与 eureka 对比</h3><ul>
<li>eureka 2.0 闭源码了</li>
<li>从官网来看 nacos 的注册的实例数是大于 eureka 的</li>
<li>因为 nacos 使用的 raft 协议,nacos 集群的一致性要远大于 eureka 集群</li>
</ul>
<p>分布式一致性协议 Raft，自 2013 年论文发表，之后就受到了技术领域的热捧，与其他的分布式一致性算法比，Raft 相对比较简单并且易于实现，这也是 Raft 能异军突起的主要因素。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/104130/1647146414817-3e1648bd-2623-4690-bf28-9e42a3d67114.png#clientId=ued4b6436-aafe-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=236&id=ud337bae4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=766&originWidth=1864&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=180596&status=done&style=none&taskId=ue131811e-f697-4ada-ab96-a532ee5bbcd&title=&width=574" alt="image.png"><br>Raft 的数据一致性策略<br>Raft 协议强依赖 Leader 节点来确保集群数据一致性。即 client 发送过来的数据均先到达 Leader 节点，Leader 接收到数据后，先将数据标记为 uncommitted 状态，随后 Leader 开始向所有 Follower 复制数据并等待响应，在获得集群中大于 N&#x2F;2 个 Follower 的已成功接收数据完毕的响应后，Leader 将数据的状态标记为 committed，随后向 client 发送数据已接收确认，在向 client 发送出已数据接收后，再向所有 Follower 节点发送通知表明该数据状态为 committed。</p>
<h3 id="1-2、与-spring-cloud-config-对比"><a href="#1-2、与-spring-cloud-config-对比" class="headerlink" title="1.2、与 spring cloud config 对比"></a>1.2、与 spring cloud config 对比</h3><p>三大优势：</p>
<ul>
<li>springcloud config 大部分场景结合 git 使用, 动态变更还需要依赖 Spring Cloud Bus 消息总线来通过所有的客户端变化</li>
<li>springcloud config 不提供可视化界面</li>
<li>nacos config 使用长连接更新配置, 一旦配置有变动后，通知 Provider 的过程非常的迅速, 从速度上秒杀 spring cloud 原来的 config 几条街</li>
</ul>
<h2 id="2、Spring-Cloud-Alibaba-套件"><a href="#2、Spring-Cloud-Alibaba-套件" class="headerlink" title="2、Spring Cloud Alibaba 套件"></a>2、Spring Cloud Alibaba 套件</h2><p>目前 Spring Cloud Alibaba 主要有三个组件：</p>
<ul>
<li>Nacos：一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</li>
<li>Sentinel：把流量作为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</li>
<li>AliCloud OSS: 阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。您可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。</li>
</ul>
<p>Spring Cloud Alibaba 套件 和 Spring Cloud Netflix 套件类比<br>仔细看看各组件的功能描述，<br>Spring Cloud Alibaba 套件和 Spring Cloud Netflix 套件大致的对应关系：</p>
<ul>
<li>Nacos &#x3D; Eureka&#x2F;Consule + Config + Admin</li>
<li>Sentinel &#x3D; Hystrix + Dashboard + Turbine</li>
<li>Dubbo &#x3D; Ribbon + Feign</li>
<li>RocketMQ &#x3D; RabbitMQ</li>
<li>Schedulerx &#x3D; Quartz</li>
<li>AliCloud OSS、AliCloud SLS 这三个应该是独有的</li>
</ul>
<p>链路跟踪（Sleuth、Zipkin）不知道会不会在 Sentinel 里<br>以上只是猜测，待我从坑里爬出来之后再回来更新。也欢迎大家一起交流探讨~<br>这里我就先试试 Nacos。</p>
<h2 id="3、Nacos-的架构和安装"><a href="#3、Nacos-的架构和安装" class="headerlink" title="3、Nacos 的架构和安装"></a>3、Nacos 的架构和安装</h2><h3 id="3-1、Nacos-的架构"><a href="#3-1、Nacos-的架构" class="headerlink" title="3.1、Nacos 的架构"></a>3.1、Nacos 的架构</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/104130/1647146632603-f0389671-a4b1-481c-9ead-1871422c593e.png#clientId=ued4b6436-aafe-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=250&id=u4d3e389c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=500&originWidth=1100&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=208181&status=done&style=none&taskId=udfc84aec-adb9-4cae-9349-11426a58d84&title=&width=550" alt="image.png"><br>这是 Nacos 的架构图，可以看到它确实是融合了服务注册发现中心、配置中心、服务管理等功能，类似于 Eureka&#x2F;Consule + Config + Admin 的合体。<br>另外通过官方文档发现，Nacos 除了可以和 Spring Cloud 集成，还可以和 Spring、SpringBoot 进行集成。不过我们只关注于 Spring Cloud，别的就略过了，直接上手实战吧。</p>
<h3 id="3-2、Nacos-Server-的下载和安装"><a href="#3-2、Nacos-Server-的下载和安装" class="headerlink" title="3.2、Nacos Server 的下载和安装"></a>3.2、Nacos Server 的下载和安装</h3><p>在使用 Nacos 之前，需要先下载 Nacos 并启动 Nacos Server。<br>安装的参考教程：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/crazymakercircle/p/11992539.html">https://www.cnblogs.com/crazymakercircle/p/11992539.html</a></p>
<h2 id="4、Nacos-Server-的运行"><a href="#4、Nacos-Server-的运行" class="headerlink" title="4、Nacos Server 的运行"></a>4、Nacos Server 的运行</h2><h3 id="4-1、两种模式"><a href="#4-1、两种模式" class="headerlink" title="4.1、两种模式"></a>4.1、两种模式</h3><p>Nacos Server 有两种运行模式：</p>
<ul>
<li><p>standalone</p>
</li>
<li></li>
<li><p>cluster</p>
</li>
</ul>
<h3 id="4-2、standalone-模式"><a href="#4-2、standalone-模式" class="headerlink" title="4.2、standalone 模式"></a>4.2、standalone 模式</h3><p>此模式一般用于 demo 和测试，不用改任何配置，直接敲以下命令执行<br><code>sh bin/startup.sh -m standalone </code><br>Windows 的话就是<br><code>cmd bin/startup.cmd -m standalone </code><br>然后从 <a target="_blank" rel="noopener" href="http://cdh1:8848/nacos/index.html">http://cdh1:8848/nacos/index.html</a> 进入控制台就能看到如下界面了<br><a target="_blank" rel="noopener" href="https://img-blog.csdnimg.cn/20190329154915102.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/104130/1647101731578-6fa3b395-c472-471e-8678-93d3bdce7aea.png#clientId=u7f5edb5f-179e-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ucbab9220&margin=%5Bobject%20Object%5D&name=image.png&originHeight=426&originWidth=1240&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=67704&status=done&style=none&taskId=ucbc9e81e-8cda-4413-9ca9-4a43b84f3d8&title=" alt="image.png"></a><br>默认账号和密码为：nacos nacos</p>
<h3 id="4-3、cluster-模式"><a href="#4-3、cluster-模式" class="headerlink" title="4.3、cluster 模式"></a>4.3、cluster 模式</h3><p>测试环境，可以先用 standalone 模式撸起来，享受 coding 的快感，但是，生产环境可以使用 cluster 模式。<br>cluster 模式需要依赖 MySQL，然后改两个配置文件：<br>conf&#x2F;cluster.conf<br>conf&#x2F;application.properties<br>大致如下：<br>1、cluster.conf，填入要运行 Nacos Server 机器的 ip<br>192.168.100.155<br>192.168.100.156<br>2、修改 NACOS_PATH&#x2F;conf&#x2F;application.properties，加入 MySQL 配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">db.num&#x3D;1
db.url.0&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;nacos_config?characterEncoding&#x3D;utf8&amp;connectTimeout&#x3D;1000&amp;socketTimeout&#x3D;3000&amp;autoReconnect&#x3D;true
db.user&#x3D;root
db.password&#x3D;root</code></pre>

<p>创建一个名为 nacos_config 的 database，将 NACOS_PATH&#x2F;conf&#x2F;nacos-mysql.sql 中的表结构导入刚才创建的库中，这几张表的用途就自己研究吧</p>
<h3 id="4-4、Nacos-Server-的配置数据是存在哪里呢？"><a href="#4-4、Nacos-Server-的配置数据是存在哪里呢？" class="headerlink" title="4.4、Nacos Server 的配置数据是存在哪里呢？"></a>4.4、Nacos Server 的配置数据是存在哪里呢？</h3><p>问题来了： Nacos Server 的配置数据是存在哪里呢？<br>我们没有对 Nacos Server 做任何配置，那么数据只有两个位置可以存储：</p>
<ul>
<li>内存</li>
<li>本地数据库</li>
</ul>
<p>如果我们现在重启刚刚在运行的 Nacos Server，会发现刚才加的 nacos.properties 配置还在，说明不是内存存储的。<br>这时候我们打开 NACOS_PATH&#x2F;data，会发现里边有个 derby-data 目录，我们的配置数据现在就存储在这个库中。</p>
<blockquote>
<p>Derby 是 Java 编写的数据库，属于 Apache 的一个开源项目</p>
</blockquote>
<p>如果将数据源改为我们熟悉的 MySQL 呢？当然可以。</p>
<blockquote>
<p>注意：不支持 MySQL 8.0 版本</p>
</blockquote>
<p>这里有两个坑：</p>
<blockquote>
<p>Nacos Server 的数据源是用 Derby 还是 MySQL 完全是由其运行模式决定的：</p>
</blockquote>
<p>standalone 的话仅会使用 Derby，即使在 application.properties 里边配置 MySQL 也照样无视； cluster 模式会自动使用 MySQL，这时候如果没有 MySQL 的配置，是会报错的。<br>官方提供的 cluster.conf 示例如下</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">#it is ip
#example
10.10.109.214
11.16.128.34
11.16.128.36</code></pre>

<p>以上配置结束后，运行 Nacos Server 就能看到效果了。</p>
<h2 id="5、配置的隔离"><a href="#5、配置的隔离" class="headerlink" title="5、配置的隔离"></a>5、配置的隔离</h2><p>在实际的应用中，存在着以下几种环境隔离的要求：<br>1、开发环境、测试环境、准生产环境和生产环境需要隔离<br>2、不同项目需要隔离<br>3、同一项目，不同的模块需要隔离<br>可以通过三种方式来进行配置隔离：Nacos 的服务器、namespace 命名空间、group 分组，在 bootstrap.yml 文件中可以通过配置 Nacos 的 server-addr、namespace 和 group 来区分不同的配置信息。</p>
<ul>
<li>Nacos 的服务器 spring.cloud.nacos.config.server-addr</li>
<li>Nacos 的命名空间 spring.cloud.nacos.config.namespace，注意，这里使用命名空间的 ID 不是名称</li>
<li>Nacos 的分组 spring.cloud.nacos.config.group</li>
</ul>
<h2 id="6、nacos-集群搭建"><a href="#6、nacos-集群搭建" class="headerlink" title="6、nacos 集群搭建"></a>6、nacos 集群搭建</h2><p>如果我们要搭建集群的话，那么肯定是不能用内嵌的数据库，不然数据无法共享。所以，集群搭建的时候我们需要将 Nacos 对接 Mysql 进行数据存储。<br>集群模式跟我们平时进行扩容是一样的，可以通过 Nginx 转发到多个节点，最前面挂一个域名即可，如下图：<a target="_blank" rel="noopener" href="https://img-blog.csdnimg.cn/20190807114946379.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/104130/1647101735764-f1376194-ae1a-442b-b723-ca0ebfd2b150.png#clientId=u7f5edb5f-179e-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=uca2877fe&margin=%5Bobject%20Object%5D&name=image.png&originHeight=476&originWidth=1098&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=39460&status=done&style=none&taskId=u19bfb715-4a35-4204-b23d-f66450a2c6e&title=" alt="image.png"></a></p>
<h3 id="IP-规划"><a href="#IP-规划" class="headerlink" title="IP 规划"></a>IP 规划</h3><p>通常如果我们只是为了体验的话，直接在本地起动 3 个实例就可以了，没必要真的去搞三台服务器，下面我们就以在本地的方式来搭建集群。 将 Nacos 的解压包复制分成 3 份，分别是:<br>nacos<br>nacos1<br>nacos2<br>进入 nacos 的 conf 目录，编辑 application.properties 文件，增加数据库配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"># 指定数据源为Mysql
spring.datasource.platform&#x3D;mysql

# 数据库实例数量
db.num&#x3D;1
db.url.0&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;nacos?characterEncoding&#x3D;utf8&amp;connectTimeout&#x3D;1000&amp;socketTimeout&#x3D;3000&amp;autoReconnect&#x3D;true
db.user&#x3D;root
db.password&#x3D;123456</code></pre>

<p>复制代码同样的步骤进入 nacos1 和 nacos2 操作一遍，唯一需要修改的就是 application.properties 文件中的 server.port，默认 nacos 的 server.port&#x3D;8848，<br>我们在本地启动三个实例，那么端口肯定会冲突，所以其他 2 个实例的端口我们需要进行修改，比如 nacos1 修改成 8847，nacos2 修改成 8846。<br>数据库配置信息好了后，我们需要将对应的数据库和表进行初始化，数据库脚本在 conf 目录下的 nacos-mysql.sql 中，执行即可。<br>最后一步需要配置一份集群节点信息，配置文件在 conf 目录下的 cluster.conf.example 文件，我们进行重命名成 cluster.conf。 然后编辑 cluster.conf 文件，增加 3 个节点的信息，格式为 IP:PORT，三个目录都一致即可。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">127.0.0.1:8848
127.0.0.1:8847
127.0.0.1:8846</code></pre>

<p>启动的话直接到 bin 目录下，执行.&#x2F;startup.sh 就可以了，默认就是集群模式，不需要加任何参数。</p>
<h3 id="集群的使用"><a href="#集群的使用" class="headerlink" title="集群的使用"></a>集群的使用</h3><p>上面的集群，虽然可用， 但仍不是真正的集群， 我们一般不会这么用。nacos 集群的使用一般有 4 种方式：</p>
<ul>
<li><a href="http://ip1:port/openAPI">http://ip1:port/openAPI</a> 直连 ip 模式，不同的节点，则需要修改 ip 才可以使用。</li>
<li><a href="http://VIP:port/openAPI">http://VIP:port/openAPI</a> VIP 模式高可用，客户端 vip 即可，VIP 下面挂 server 真实 ip，部署比较麻烦，需要部署 vip（keepalive）。</li>
<li><a href="http://nacos.com:port/openAPI">http://nacos.com:port/openAPI</a> 域名模式，可读性好，而且换 ip 方便，在 host 文件配置本地域名即可。</li>
<li>http:&#x2F;&#x2F;反向代理:port&#x2F;openAPI 反向代理模式</li>
</ul>
<p>这里介绍一下反向代理模式。<br>关于 Nginx 的安装和配置，本文就不进行讲解了，不会的可以自己去尝试下，反向代理模式 核心配置如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">upstream nacos_server &#123;
  server 127.0.0.1:8848;
  server 127.0.0.1:8847;
  server 127.0.0.1:8846;
&#125;

server &#123;
listen 8648;
   server_name localhost;
  #charset koi8-r;
  #access_log logs&#x2F;host.access.log main;
  location &#x2F; &#123;
     proxy_pass http:&#x2F;&#x2F;nacos_server;
     index index.html index.htm;
   &#125;
&#125;</code></pre>

<p>整体来说，nacos 的集群搭建方式还是挺简单的，没什么特别要注意的，最好是能通过域名的方式来进行访问，另外数据库这块如果上生产环境，也需要考虑高可用问题，至少也得有个主从。<br>8648 的 nginx 提供的 nacos 服务接口，可以自定义。 我们访问<br><a target="_blank" rel="noopener" href="http://localhost:8648/nacos/#/clusterManagement?dataId=&amp;group=&amp;appName=&amp;namespace=&amp;serverId=">http://localhost:8648/nacos/#/clusterManagement?dataId=&amp;group=&amp;appName=&amp;namespace=&amp;serverId=</a><br>，就可以看到：<br><a target="_blank" rel="noopener" href="https://img2018.cnblogs.com/blog/493842/201907/493842-20190717151826015-620927747.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/104130/1647101735813-7e09f91a-e566-44dc-84c1-1ee7fd5362f3.png#clientId=u7f5edb5f-179e-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ude292ffd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=616&originWidth=1419&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=54160&status=done&style=none&taskId=u04ec9c2b-0562-442d-9fba-e72db88e109&title=" alt="image.png"></a><br>我们可以简单测试一下，杀掉 一个的 nacos ，看服务是否正常。 后面，我们对微服务提供 nacos 服务的时候，只要配置这个 nginx 端口就好了！！</p>
<h3 id="新版本部署"><a href="#新版本部署" class="headerlink" title="新版本部署"></a>新版本部署</h3><p>Nacos2.0 版本相比 1.X 新增了 gRPC 的通信方式，因此需要增加 2 个端口。新增端口是在配置的主端口(server.port)基础上，进行一定偏移量自动生成。</p>
<table><thead><tr>
<th><strong>端口</strong></th>
<th><strong>与主端口的偏移量</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead><tbody><tr>
<td>9848</td>
<td>1000</td>
<td>客户端 gRPC 请求服务端端口，用于客户端向服务端发起连接和请求</td>
</tr>
<tr>
<td>9849</td>
<td>1001</td>
<td>服务端 gRPC 请求服务端端口，用于服务间同步等</td>
</tr>
</tbody></table><p>使用 VIP&#x2F;nginx 请求时，需要配置成 TCP 转发，不能配置 http2 转发，否则连接会被 nginx 断开。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/104130/1647149978462-a0be9d46-22fa-44d9-b96f-6a8861c93f51.png#clientId=ud9238c9c-8bab-4&crop=0&crop=0.0867&crop=1&crop=0.794&from=paste&height=1125&id=u33618615&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1125&originWidth=2000&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=108422&status=done&style=none&taskId=u1b99182e-30dd-4d07-8b92-e0f135109da&title=&width=2000" alt="image.png"><br>客户端拥有相同的计算逻辑，用户如同 1.X 的使用方式，配置主端口(默认 8848)，通过相同的偏移量，计算对应 gRPC 端口(默认 9848)。<br>因此如果客户端和服务端之前存在端口转发，或防火墙时，需要对端口转发配置和防火墙配置做相应的调整。其余部署参考<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/deployment.html">Nacos 部署手册</a> ，将版本相关替换成 2.0.0。</p>

</div>
<footer class="post-meta">
    <span class="post-tag">
        
        <span class="post-meta-item-icon">
                <i class="fa far fa-folder-open"></i>
            </span>
        
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                <a href="/tags/Nacos/" itemprop="url" rel="index">
                  <span itemprop="name">Nacos</span>
                </a>
            </span>
        
        
    </span>
</footer>

<div class="author">
    <!--个人信息-->
    
    <img class="author-image qrcode" itemprop="image"
         src="/images/mp_qrcode.jpg"
         alt="/images/mp_qrcode.jpg"/>
    
</div>


<div class="post-nav">
    <div class="post-nav-next post-nav-item">
        
        <a href="/article/etcd/etcd-watch/" rel="next" title="Etcd Watch机制">
            <i class="fa far fa-chevron-left"></i> Etcd Watch机制
        </a>
        
    </div>
    <span class="post-nav-divider"></span>
    <div class="post-nav-prev post-nav-item">
        
        <a href="/article/nacos/nacos-config/" rel="prev" title="Nacos2动态配置">
            Nacos2动态配置 <i class="fa far fa-chevron-right"></i>
        </a>
        
    </div>
</div>

        </section>
    </div>
    <div id="post-toc" class="post-toc">
        <div class="post-toc-title">文章目录</div>
        <div class="post-toc-content">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Nacos-%E4%BC%98%E5%8A%BF"><span class="toc-text">1、Nacos 优势</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81%E4%B8%8E-eureka-%E5%AF%B9%E6%AF%94"><span class="toc-text">1.1、与 eureka 对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81%E4%B8%8E-spring-cloud-config-%E5%AF%B9%E6%AF%94"><span class="toc-text">1.2、与 spring cloud config 对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Spring-Cloud-Alibaba-%E5%A5%97%E4%BB%B6"><span class="toc-text">2、Spring Cloud Alibaba 套件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Nacos-%E7%9A%84%E6%9E%B6%E6%9E%84%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-text">3、Nacos 的架构和安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81Nacos-%E7%9A%84%E6%9E%B6%E6%9E%84"><span class="toc-text">3.1、Nacos 的架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81Nacos-Server-%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-text">3.2、Nacos Server 的下载和安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Nacos-Server-%E7%9A%84%E8%BF%90%E8%A1%8C"><span class="toc-text">4、Nacos Server 的运行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-text">4.1、两种模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81standalone-%E6%A8%A1%E5%BC%8F"><span class="toc-text">4.2、standalone 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81cluster-%E6%A8%A1%E5%BC%8F"><span class="toc-text">4.3、cluster 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E3%80%81Nacos-Server-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%98%AF%E5%AD%98%E5%9C%A8%E5%93%AA%E9%87%8C%E5%91%A2%EF%BC%9F"><span class="toc-text">4.4、Nacos Server 的配置数据是存在哪里呢？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E9%85%8D%E7%BD%AE%E7%9A%84%E9%9A%94%E7%A6%BB"><span class="toc-text">5、配置的隔离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81nacos-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-text">6、nacos 集群搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-%E8%A7%84%E5%88%92"><span class="toc-text">IP 规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">集群的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2"><span class="toc-text">新版本部署</span></a></li></ol></li></ol>
        </div>
    </div>
    
</div>

  <!-- footer -->
  <div class="footer">
    <div class="container justify-content-center py-4">
        Charles &copy;2022 &nbsp <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备14035515号-1</a></span> &nbsp
        <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253510913'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1253510913%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
    </div>

    <!-- scrollTop -->
    <div class="go-top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- js -->
    
<script src="/lib/jquery/jquery.min.js"></script>

    
<script src="/lib/popper.js/popper.js"></script>

    
<script src="/lib/bootstrap/js/bootstrap.min.js"></script>

    
<script src="/lib/prism/js/prism.js"></script>

    
<script src="/js/app.js"></script>


    
</div>
</body>

</html>
